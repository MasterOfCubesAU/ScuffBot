CREATE TABLE
	`SixManParty` (
		`PartyID` INTEGER NOT NULL AUTO_INCREMENT,
		`LobbyID` INTEGER DEFAULT NULL,
		`GameID` INTEGER DEFAULT NULL,
		PRIMARY KEY (`PartyID`)
	);

CREATE TABLE
	`SixManLobby` (
		`LobbyID` INTEGER NOT NULL,
		`MessageID` TEXT NOT NULL,
		`VoiceChannelID` TEXT NOT NULL,
		`TextChannelID` TEXT NOT NULL,
		`RoleID` TEXT NOT NULL,
		`VoiceChannelA` VARCHAR(255) DEFAULT NULL UNIQUE,
		`VoiceChannelB` VARCHAR(255) DEFAULT NULL UNIQUE,
		PRIMARY KEY (`LobbyID`)
	);

CREATE TABLE
	`SixManGames` (
		`GameID` INTEGER NOT NULL AUTO_INCREMENT,
		`Timestamp` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
		`1v1_A` INTEGER DEFAULT NULL,
		`1v1_B` INTEGER DEFAULT NULL,
		`2v2_A` INTEGER DEFAULT NULL,
		`2v2_B` INTEGER DEFAULT NULL,
		`3v3_A` INTEGER DEFAULT NULL,
		`3v3_B` INTEGER DEFAULT NULL,
		PRIMARY KEY (`GameID`)
	);

CREATE TABLE
	`SixManUsers` (
		`PartyID` INTEGER NOT NULL,
		`UserID` VARCHAR(255) NOT NULL,
		`Type` INTEGER NOT NULL DEFAULT 0,
		`Team` INTEGER NOT NULL DEFAULT 0,
		`isOnesPlayer` INTEGER DEFAULT NULL,
		PRIMARY KEY (`PartyID`, `UserID`)
	);

ALTER TABLE `SixManParty` ADD CONSTRAINT `FK_LobbyID_SixManParty` FOREIGN KEY (`LobbyID`) REFERENCES `SixManLobby` (`LobbyID`) ON DELETE SET NULL,
ADD CONSTRAINT `FK_GameID` FOREIGN KEY (`GameID`) REFERENCES `SixManGames` (`GameID`) ON DELETE SET NULL;

ALTER TABLE `SixManUsers` ADD CONSTRAINT `FK_PartyID_SixManUsers` FOREIGN KEY (`PartyID`) REFERENCES `SixManParty` (`PartyID`) ON DELETE CASCADE;

DELIMITER $$

CREATE TRIGGER DeletePartyCascade
AFTER DELETE ON SixManParty
FOR EACH ROW
BEGIN
  DELETE FROM SixManLobby WHERE LobbyID = OLD.LobbyID;
  DELETE FROM SixManGames WHERE GameID = OLD.GameID;
END $$

DELIMITER ;
